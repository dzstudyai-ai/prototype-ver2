
-- Recreate table (Global Grades)
DROP TABLE IF EXISTS official_grades;
CREATE TABLE official_grades (
    id bigint generated always as identity primary key,
    matricule text not null,
    subject text not null,
    semestre text not null,
    exam_score numeric(4,2),
    td_score numeric(4,2),
    final_note numeric(4,2),
    absent boolean default false,
    observation text,
    created_at timestamp with time zone default now(),
    -- Unique constraint to prevent duplicates per subject/semestre
    unique(matricule, subject, semestre)
);

ALTER TABLE official_grades ENABLE ROW LEVEL SECURITY;
-- Allow public read (for verification by student ID)
CREATE POLICY "Public Read" ON official_grades FOR SELECT USING (true);
-- Allow service role full access
CREATE POLICY "Service Write" ON official_grades FOR ALL USING (true) WITH CHECK (true);

-- Data for Algèbre 3 (S3) provided manually
INSERT INTO official_grades (matricule, subject, semestre, final_note, absent, observation) VALUES
('232431545108', 'Algèbre 3', 'S3', 9.5, false, NULL),
('242431414415', 'Algèbre 3', 'S3', 10.5, false, NULL),
('242431476307', 'Algèbre 3', 'S3', 5.5, false, NULL),
('242434020006', 'Algèbre 3', 'S3', 10.25, false, NULL),
('242431069010', 'Algèbre 3', 'S3', 11.75, false, NULL),
('242431689513', 'Algèbre 3', 'S3', NULL, false, NULL),
('242431114405', 'Algèbre 3', 'S3', NULL, false, NULL),
('242434018611', 'Algèbre 3', 'S3', 10.5, false, NULL),
('242432150612', 'Algèbre 3', 'S3', 18.75, false, NULL),
('242431138115', 'Algèbre 3', 'S3', 9, false, NULL),
('242432147611', 'Algèbre 3', 'S3', 2.75, false, NULL),
('242439006404', 'Algèbre 3', 'S3', 12, false, NULL),
('242431564710', 'Algèbre 3', 'S3', 7.75, false, NULL),
('242431447710', 'Algèbre 3', 'S3', 12.25, false, NULL),
('242435455304', 'Algèbre 3', 'S3', 10.25, false, NULL),
('242431063211', 'Algèbre 3', 'S3', 14.75, false, NULL),
('232335111213', 'Algèbre 3', 'S3', 8, false, NULL),
('242431441705', 'Algèbre 3', 'S3', 15.5, false, NULL),
('242431447806', 'Algèbre 3', 'S3', 7.25, false, NULL),
('232431545419', 'Algèbre 3', 'S3', 7.25, false, NULL),
('242437256403', 'Algèbre 3', 'S3', 13.75, false, NULL),
('242431483704', 'Algèbre 3', 'S3', 20, false, NULL),
('242437543802', 'Algèbre 3', 'S3', 15, false, NULL),
('242436197902', 'Algèbre 3', 'S3', 12.5, false, NULL),
('242433212814', 'Algèbre 3', 'S3', 8.75, false, NULL),
('242431486918', 'Algèbre 3', 'S3', 7, false, NULL),
('242432181109', 'Algèbre 3', 'S3', 12.75, false, NULL),
('242431211310', 'Algèbre 3', 'S3', 10.5, false, NULL),
('242439492503', 'Algèbre 3', 'S3', 8.75, false, NULL),
('242431271418', 'Algèbre 3', 'S3', 10.5, false, NULL),
('242432443607', 'Algèbre 3', 'S3', 7.5, false, NULL),
('242431621011', 'Algèbre 3', 'S3', 11.75, false, NULL),
('242432231017', 'Algèbre 3', 'S3', 9.5, false, NULL),
('242431360714', 'Algèbre 3', 'S3', 15.5, false, NULL),
('242432150318', 'Algèbre 3', 'S3', 14, false, NULL),
('242431666515', 'Algèbre 3', 'S3', 11.5, false, NULL),
('242437439404', 'Algèbre 3', 'S3', 10.5, false, NULL),
('242431689520', 'Algèbre 3', 'S3', 6.75, false, NULL),
('242431285517', 'Algèbre 3', 'S3', 9.75, false, NULL),
('232435514519', 'Algèbre 3', 'S3', 14.75, false, NULL),
('242431128907', 'Algèbre 3', 'S3', 12.25, false, NULL),
('222436421806', 'Algèbre 3', 'S3', 12.25, false, NULL),
('242431122602', 'Algèbre 3', 'S3', 8.5, false, NULL),
('242436015307', 'Algèbre 3', 'S3', 6.75, false, NULL),
('242438006419', 'Algèbre 3', 'S3', 9.5, false, NULL),
('242431688411', 'Algèbre 3', 'S3', 5.25, false, NULL),
('242436374906', 'Algèbre 3', 'S3', 9.75, false, NULL),
('242431039111', 'Algèbre 3', 'S3', 16.75, false, NULL),
('232434564517', 'Algèbre 3', 'S3', 10.75, false, NULL),
('242435031908', 'Algèbre 3', 'S3', 20, false, NULL),
('242431757009', 'Algèbre 3', 'S3', 7, false, NULL),
('242435382908', 'Algèbre 3', 'S3', 8.5, false, NULL),
('242434244008', 'Algèbre 3', 'S3', 10.25, false, NULL),
('242435379612', 'Algèbre 3', 'S3', 9.25, false, NULL),
('232331624111', 'Algèbre 3', 'S3', 5, false, NULL),
('232438436004', 'Algèbre 3', 'S3', 8.5, false, NULL),
('242431454213', 'Algèbre 3', 'S3', 8.75, false, NULL),
('242432236910', 'Algèbre 3', 'S3', 5.75, false, NULL),
('242432573917', 'Algèbre 3', 'S3', 7.25, false, NULL),
('242435455601', 'Algèbre 3', 'S3', 9.25, false, NULL),
('242431238005', 'Algèbre 3', 'S3', 2, false, NULL),
('242431243410', 'Algèbre 3', 'S3', 12.5, false, NULL),
('242431209901', 'Algèbre 3', 'S3', 9, false, NULL),
('242435399712', 'Algèbre 3', 'S3', 16.25, false, NULL),
('242433185602', 'Algèbre 3', 'S3', 8, false, NULL),
('242432582318', 'Algèbre 3', 'S3', 18.25, false, NULL),
('232432132415', 'Algèbre 3', 'S3', 9.5, false, NULL),
('242432031104', 'Algèbre 3', 'S3', 10.75, false, NULL),
('242431209206', 'Algèbre 3', 'S3', 14, false, NULL),
('242431621017', 'Algèbre 3', 'S3', 6.25, false, NULL),
('242436136204', 'Algèbre 3', 'S3', 3.75, false, NULL),
('242439491402', 'Algèbre 3', 'S3', 8.75, false, NULL),
('242436028217', 'Algèbre 3', 'S3', 0, false, NULL),
('242435558904', 'Algèbre 3', 'S3', 8.5, false, NULL),
('242433011410', 'Algèbre 3', 'S3', 14.5, false, NULL),
('242436015401', 'Algèbre 3', 'S3', 11.5, false, NULL),
('242438479406', 'Algèbre 3', 'S3', 5.5, false, NULL),
('242431723513', 'Algèbre 3', 'S3', 14.75, false, NULL),
('242434398614', 'Algèbre 3', 'S3', 19.75, false, NULL),
('242433061720', 'Algèbre 3', 'S3', 10, false, NULL),
('242431461904', 'Algèbre 3', 'S3', 13.25, false, NULL),
('242431068911', 'Algèbre 3', 'S3', NULL, false, NULL),
('242431597805', 'Algèbre 3', 'S3', 15.25, false, NULL),
('242437139207', 'Algèbre 3', 'S3', 15.25, false, NULL),
('242432485803', 'Algèbre 3', 'S3', 9.25, false, NULL),
('242431211102', 'Algèbre 3', 'S3', 8.5, false, NULL),
('242431680416', 'Algèbre 3', 'S3', 10.25, false, NULL),
('242431622205', 'Algèbre 3', 'S3', 16, false, NULL),
('242431621911', 'Algèbre 3', 'S3', 9.75, false, NULL),
('242435579812', 'Algèbre 3', 'S3', 13, false, NULL),
('232433250512', 'Algèbre 3', 'S3', 12, false, NULL),
('242431461706', 'Algèbre 3', 'S3', 12.25, false, NULL),
('242439558901', 'Algèbre 3', 'S3', 11.75, false, NULL),
('242431617802', 'Algèbre 3', 'S3', 9.25, false, NULL),
('242431047211', 'Algèbre 3', 'S3', 8.5, false, NULL),
('242436241818', 'Algèbre 3', 'S3', 11.75, false, NULL),
('242431462201', 'Algèbre 3', 'S3', 8.25, false, NULL),
('242431689720', 'Algèbre 3', 'S3', 15.5, false, NULL),
('242432466211', 'Algèbre 3', 'S3', 8.75, false, NULL),
('242431714606', 'Algèbre 3', 'S3', 9.75, false, NULL),
('242431453410', 'Algèbre 3', 'S3', 11.25, false, NULL),
('242431142903', 'Algèbre 3', 'S3', 9.25, false, NULL),
('232336274915', 'Algèbre 3', 'S3', 4.25, false, NULL),
('242439048618', 'Algèbre 3', 'S3', 9.75, false, NULL),
('232333054905', 'Algèbre 3', 'S3', 11.5, false, NULL),
('242432049603', 'Algèbre 3', 'S3', 10.5, false, NULL),
('242439043710', 'Algèbre 3', 'S3', 12.75, false, NULL),
('242431689615', 'Algèbre 3', 'S3', 11.5, false, NULL),
('242431398703', 'Algèbre 3', 'S3', 13.5, false, NULL),
('242431621219', 'Algèbre 3', 'S3', 12.25, false, NULL),
('242432487106', 'Algèbre 3', 'S3', 6.75, false, NULL),
('242431414605', 'Algèbre 3', 'S3', 8, false, NULL),
('242436176802', 'Algèbre 3', 'S3', 15, false, NULL),
('242432150608', 'Algèbre 3', 'S3', 10, false, NULL),
('232431858719', 'Algèbre 3', 'S3', 8.25, false, NULL),
('242433153202', 'Algèbre 3', 'S3', 10.5, false, NULL),
('242431271804', 'Algèbre 3', 'S3', 16.75, false, NULL),
('242432557305', 'Algèbre 3', 'S3', 9.25, false, NULL),
('242432150717', 'Algèbre 3', 'S3', 14, false, NULL),
('242431211201', 'Algèbre 3', 'S3', 2.75, false, NULL),
('242431423701', 'Algèbre 3', 'S3', 6.5, false, NULL),
('242431620320', 'Algèbre 3', 'S3', 7.5, false, NULL),
('242438572814', 'Algèbre 3', 'S3', 11.75, false, NULL),
('242431475705', 'Algèbre 3', 'S3', 14.75, false, NULL),
('242431035804', 'Algèbre 3', 'S3', 13, false, NULL),
('242431598508', 'Algèbre 3', 'S3', 13.5, false, NULL),
('242432042406', 'Algèbre 3', 'S3', 9, false, NULL),
('242437589418', 'Algèbre 3', 'S3', 12, false, NULL),
('232435214402', 'Algèbre 3', 'S3', 5.75, false, NULL),
('242432225016', 'Algèbre 3', 'S3', 7.25, false, NULL),
('242432562607', 'Algèbre 3', 'S3', 13, false, NULL),
('242431222914', 'Algèbre 3', 'S3', 9.5, false, NULL),
('242435570418', 'Algèbre 3', 'S3', 2.75, false, NULL),
('242431281912', 'Algèbre 3', 'S3', 9.5, false, NULL),
('242431390901', 'Algèbre 3', 'S3', 7.25, false, NULL),
('242435426902', 'Algèbre 3', 'S3', 7, false, NULL),
('242433372103', 'Algèbre 3', 'S3', 10.5, false, NULL),
('242434244806', 'Algèbre 3', 'S3', NULL, false, NULL),
('242431485807', 'Algèbre 3', 'S3', 14.5, false, NULL),
('242432438101', 'Algèbre 3', 'S3', 10.25, false, NULL),
('242437233412', 'Algèbre 3', 'S3', 7.75, false, NULL),
('242431142801', 'Algèbre 3', 'S3', 11.25, false, NULL),
('242433293509', 'Algèbre 3', 'S3', 8, false, NULL),
('242435558708', 'Algèbre 3', 'S3', 10.25, false, NULL);
